{% extends 'base.html.twig' %}

{% block title %}Episode #{{ episode.number }}{% endblock %}

{% block body %}
    <div class="page zoom">
        <div class="media">
            <div class="media-body">
                <h1 class="mt-0"> <a class="zoomLink" href="{{ path('program_season_show', {'slug': program.slug, 'number': season.number}) }}">Episode {{ episode.number }} </a>  / Saison {{ season.number }}  de {{ program.title }}</h1>
                <p>{{ episode.title }}</p>
                <p>{{ episode.synopsis }}</p>

                {% if app.user %}
                    <h3>Ajouter un commentaire</h3>
                    {{ form_start(form) }}
                    {{ form_widget(form) }}
                    <button type="submit">Ajouter un commentaire</button>
                    {{ form_end(form) }}
                {% else %}
                    <p>Vous devez être connecté pour ajouter un commentaire.</p>
                {% endif %}

                {% if episode.comments|length > 0 %}
                    <h3>Commentaires :</h3>
                    <ul>
                        {% set commentsSorted = commentRepository.findBy({'episode': episode}, {'createdAt': 'ASC'}) %}
                        {% for comment in commentsSorted %}
                            <li>
                                <p>{{ comment.author.email  }} / note {{ comment.rate}}/5</p>
                                <p> fait le : {{ comment.createdAt|date('d/m/Y') }}</p>
                                <p>commentaire : {{ comment.comment }}</p>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>Aucun commentaire pour le moment.</p>
                {% endif %}

            </div>

            <a href="{{ path('program_season_show', {'slug': program.slug, 'number': season.number}) }}">
                Retour à la page de la série
            </a>
        </div>
    </div>
{% endblock %}